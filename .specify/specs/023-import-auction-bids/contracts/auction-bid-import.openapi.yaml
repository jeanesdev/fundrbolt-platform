openapi: 3.0.3
info:
  title: Auction Bid Import API
  version: 1.0.0
paths:
  /api/v1/admin/events/{event_id}/auction-bids/dashboard:
    get:
      summary: Get auction bids dashboard summary
      parameters:
        - in: path
          name: event_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Dashboard summary
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BidsDashboard"
  /api/v1/admin/events/{event_id}/auction-bids/import/preflight:
    post:
      summary: Preflight an auction bid import file
      parameters:
        - in: path
          name: event_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Preflight results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PreflightResult"
  /api/v1/admin/events/{event_id}/auction-bids/import/confirm:
    post:
      summary: Confirm a preflighted auction bid import
      parameters:
        - in: path
          name: event_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file, import_batch_id]
              properties:
                file:
                  type: string
                  format: binary
                import_batch_id:
                  type: string
      responses:
        "200":
          description: Import confirmation summary
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImportSummary"
components:
  schemas:
    BidsDashboard:
      type: object
      required: [total_bid_count, total_bid_value, highest_bids, recent_bids]
      properties:
        total_bid_count:
          type: integer
        total_bid_value:
          type: number
        highest_bids:
          type: array
          items:
            $ref: "#/components/schemas/HighestBid"
        recent_bids:
          type: array
          items:
            $ref: "#/components/schemas/RecentBid"
    HighestBid:
      type: object
      required: [auction_item_code, bid_amount, bidder_email]
      properties:
        auction_item_code:
          type: string
        bid_amount:
          type: number
        bidder_email:
          type: string
    RecentBid:
      type: object
      required: [auction_item_code, bid_amount, bidder_email, bid_time]
      properties:
        auction_item_code:
          type: string
        bid_amount:
          type: number
        bidder_email:
          type: string
        bid_time:
          type: string
          format: date-time
    PreflightResult:
      type: object
      required:
        [import_batch_id, detected_format, total_rows, valid_rows, invalid_rows, warning_rows, row_errors]
      properties:
        import_batch_id:
          type: string
        detected_format:
          type: string
        total_rows:
          type: integer
        valid_rows:
          type: integer
        invalid_rows:
          type: integer
        warning_rows:
          type: integer
        row_errors:
          type: array
          items:
            $ref: "#/components/schemas/RowIssue"
        row_warnings:
          type: array
          items:
            $ref: "#/components/schemas/RowIssue"
        error_report_url:
          type: string
          nullable: true
    RowIssue:
      type: object
      required: [row_number, severity, message]
      properties:
        row_number:
          type: integer
        severity:
          type: string
          enum: [error, warning]
        field_name:
          type: string
          nullable: true
        message:
          type: string
        raw_value:
          type: string
          nullable: true
    ImportSummary:
      type: object
      required: [import_batch_id, created_bids, skipped_bids, started_at, completed_at]
      properties:
        import_batch_id:
          type: string
        created_bids:
          type: integer
        skipped_bids:
          type: integer
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
